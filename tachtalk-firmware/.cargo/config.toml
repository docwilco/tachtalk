[build]
target = "xtensa-esp32s3-espidf"
# Use a per-crate target dir instead of the workspace target dir, so that
# switching between firmware crates doesn't trigger esp-idf-sys recompilation
# (each has different sdkconfig and ESP_IDF_SYS_ROOT_CRATE settings).
target-dir = "target"

[target.xtensa-esp32s3-espidf]
linker = "ldproxy"
runner = "espflash flash --monitor --baud 3000000"

[unstable]
build-std = ["std", "panic_abort"]

[env]
MCU = "esp32s3"
ESP_IDF_VERSION = "v5.3"
ESP_IDF_SDKCONFIG_DEFAULTS = { value = "sdkconfig.defaults", relative = true }
ESP_IDF_SYS_ROOT_CRATE = "tachtalk-firmware"
# Copy partitions.csv into the esp-idf-sys cmake build directory so that
# CONFIG_PARTITION_TABLE_CUSTOM_FILENAME can find it.
ESP_IDF_GLOB_0_BASE = { value = ".", relative = true }
ESP_IDF_GLOB_0_0 = "partitions.csv"
